<template>
  <section class="container">
    <div class="people-num">
      <div v-for="n in 11" :key="n">
        <div class="field is-horizontal">
          <div class="field-label is-normal">
            <div v-if="n < 6">
              <label class="label level-lavel">{{ n }}等級</label>
            </div>
            <div v-else>
              <label class="label level-lavel">V{{ n - 6 }}等級</label>
            </div>
          </div>
          <div class="field-body">
            <div class="field">
              <p class="control">
                <input
                  v-model="people[n - 1].num"
                  class="input"
                  type="number"
                  placeholder="0"
                />
              </p>
            </div>
          </div>
        </div>
      </div>
      <nuxt-link :to="{ path: '/costInfo' }">原価情報はこちら</nuxt-link>
    </div>
    <div class="main-content">
      <p>{{ toHms(timer) }}</p>
      <p>人件費原価：{{ Math.round(money) }}円</p>
      <p>共通費込み：{{ Math.round(moneyAddCommonCost) }}円</p>
      <p>想定価格：{{ Math.round(estimatedMoney) }}円</p>
      <p v-if="state === 1">
        節約価格：{{ Math.round(estimatedMoney - money) }}円
      </p>
      <p>
        <button class="button is-primary is-large" @click="startTimer">
          Start
        </button>
        <button class="button is-primary is-large" @click="stopTimer">
          Stop
        </button>
        <button class="button is-primary is-large" @click="ResetTimer">
          Reset
        </button>
      </p>
      <div>
        <div class="field-label is-normal">
          <label class="label level-lavel">想定時間</label>
        </div>
        <input
          v-model="estimatedTime"
          class="input"
          type="number"
          placeholder="30分"
        />
      </div>
    </div>
  </section>
</template>

<script>
export default {
  data() {
    return {
      state: 0, // 0 = initial, 1=stop, 2=start
      estimatedMoney: 0,
      estimatedTime: 0,
      timer: 0,
      money: 0,
      moneyAddCommonCost: 0,
      people: [
        { level: 1, num: 0 },
        { level: 2, num: 0 },
        { level: 3, num: 0 },
        { level: 4, num: 0 },
        { level: 5, num: 0 },
        { level: 6, num: 0 },
        { level: 7, num: 0 },
        { level: 8, num: 0 },
        { level: 9, num: 0 },
        { level: 10, num: 0 },
        { level: 11, num: 0 }
      ],
      account: [
        { level: 1, salary: 2135, profitableSalary: 10000, commonCost: 1750 },
        { level: 2, salary: 2396, profitableSalary: 10300, commonCost: 1965 },
        { level: 3, salary: 2682, profitableSalary: 10700, commonCost: 2199 },
        { level: 4, salary: 2969, profitableSalary: 11100, commonCost: 2435 },
        { level: 5, salary: 3385, profitableSalary: 11700, commonCost: 2800 },
        { level: 6, salary: 4010, profitableSalary: 12600, commonCost: 3288 },
        { level: 7, salary: 4583, profitableSalary: 13500, commonCost: 4496 },
        { level: 8, salary: 5208, profitableSalary: 14300, commonCost: 4270 },
        { level: 9, salary: 5990, profitableSalary: 15500, commonCost: 4911 },
        { level: 10, salary: 6875, profitableSalary: 16700, commonCost: 5637 },
        { level: 11, salary: 7813, profitableSalary: 18100, commonCost: 6407 }
      ]
    }
  },
  methods: {
    startTimer() {
      this.intervalId = setInterval(() => {
        // 処理内容
        this.timer += 1

        for (let i = 0; i < this.people.length; i++) {
          for (let j = 0; j < this.people[i].num; j++) {
            this.money += this.account[this.people[i].level - 1].salary / 3600
            this.moneyAddCommonCost +=
              this.account[this.people[i].level - 1].salary / 3600 +
              this.account[this.people[i].level - 1].commonCost / 3600
          }
        }
      }, 1000) // 1秒間隔で処理

      this.estimatedMoney = 0
      for (let i = 0; i < this.people.length; i++) {
        const salaryPerMinutes =
          this.account[this.people[i].level - 1].salary / 60
        this.estimatedMoney +=
          salaryPerMinutes * this.estimatedTime * this.people[i].num
      }
      this.state = 2
    },
    stopTimer() {
      clearInterval(this.intervalId)
      this.state = 1
    },
    ResetTimer() {
      this.timer = 0
      this.money = 0
      this.moneyAddCommonCost = 0
    },
    toHms(t) {
      let hms = ''
      const h = (t / 3600) | 0
      const m = ((t % 3600) / 60) | 0
      const s = t % 60

      if (h !== 0) {
        hms = padZero(h) + ':' + padZero(m) + ':' + padZero(s)
      } else if (m !== 0) {
        hms = '00:' + padZero(m) + ':' + padZero(s)
      } else {
        hms = '00:' + '00:' + padZero(s)
      }

      return hms
    },
    sliceMoney(money) {
      return this.money.slice(0, 4)
    }
  }
}

function padZero(v) {
  if (v < 10) {
    return '0' + v
  } else {
    return v
  }
}
</script>

<style scoped>
.container {
  margin: 0 auto;
  min-height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  text-align: center;
}

.title {
  font-family: 'Quicksand', 'Source Sans Pro', -apple-system, BlinkMacSystemFont,
    'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  display: block;
  font-weight: 300;
  font-size: 100px;
  color: #35495e;
  letter-spacing: 1px;
}

.subtitle {
  font-weight: 300;
  font-size: 42px;
  color: #526488;
  word-spacing: 5px;
  padding-bottom: 15px;
}

.links {
  padding-top: 15px;
}

.people-num {
  flex: 1;
}

.main-content {
  flex: 2;
}
.level-lavel {
  width: 10vw;
}
.main-content p {
  font-size: 3rem;
}
@media screen and (max-width: 480px) {
  .container {
    display: block;
  }
  .field {
    display: flex;
  }
  .field-label {
    flex: 1;
    margin-left: 10%;
  }
  .field-body {
    flex: 2;
  }
}
</style>
